<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Labwindows.Tutorial.Chapter 3.Part1 &#8211; Lyfing.Loo's Blog</title>
<meta name="description" content="Yet another guy dreams for landing on the moon someday">
<meta name="keywords" content="Tech, C, Labwindows Tutorial">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Labwindows.Tutorial.Chapter 3.Part1">
<meta property="og:description" content="Yet another guy dreams for landing on the moon someday">
<meta property="og:url" content="http://localhost:4000/Labwindows-tutorial-chapter3-part1">
<meta property="og:site_name" content="Lyfing.Loo's Blog">





<link rel="canonical" href="http://localhost:4000/Labwindows-tutorial-chapter3-part1">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Lyfing.Loo's Blog Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">




<style type="text/css">body {background-image:url(http://localhost:4000/images/ps_neutral.png);}</style>


</head>

<body id="post"  itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://localhost:4000">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://localhost:4000/images/avatar.jpg" alt="Lyfing.Loo photo" class="author-photo">
					<h4>Lyfing.Loo</h4>
					<p></p>
				</li>
				<li><a href="http://localhost:4000/about/">Learn More</a></li>
				<li>
					<a href="mailto:hellolyfing@gmail.com"><i class="icon-envelope"></i> Email</a>
				</li>
				
				
				
				
				
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://localhost:4000/archive/">All Posts</a></li>
				<li><a href="http://localhost:4000/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title" itemprop="name"><a href="http://localhost:4000/Labwindows-tutorial-chapter3-part1" rel="bookmark" title="Labwindows.Tutorial.Chapter 3.Part1" itemprop="url">Labwindows.Tutorial.Chapter 3.Part1</a></h1>
        
        <h2>October 10, 2013</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content" itemprop="description">
      <p><a href="http://lanfengming.com/Labwindows-tutorial-chapter2.html/">上一篇</a>中我们讲了如何<strong>使用界面编辑器</strong>创建一个Graph控件，并通过绑定代码在它上面显示Sine波和Cosine波。</p>

<p>本篇虽然仍要创建Graph，不过所有的图形创建工作都将由<strong>代码</strong>完成。也就是说，从头到尾，你无需再借助界面编辑器来完成创建控件、设置属性、绑定回调函数等工作，上述内容都将在一个<strong>.c</strong>文件中由代码来实现。</p>

<p>而且说实在的，授人以鱼不如授人以渔。这个系列教程不可能从零开始详尽介绍各个控件、内建函数的使用方法，一来确实内容太多，无力一一详述；二来这些东西本就在<strong>官方文档</strong>中有足够详尽的使用说明，自己再来赘述反倒没有意义。<strong>此系列教程更多的意义在于</strong>：在引导新手慢慢上手、熟悉Labwindows开发环境的同时，教会新手自己查阅帮助文档解决问题，最终达到新手可以自己查找帮助文档解决问题的目的。我想教会人用字典比每个字手把手教更有意义，对吧？因此从本篇开始会侧重介绍帮助文档的使用。</p>

<!--more-->

<p>本篇任务：</p>

<ul>
  <li>用代码在主面板上创建一个Graph控件；</li>
  <li><strong>显示波形按钮</strong>、<strong>清除波形按钮</strong>；</li>
  <li>开始尝试从帮助文档中寻找解决问题的答案或方案</li>
</ul>

<p>效果图：</p>

<p><img src="http://ww1.sinaimg.cn/large/6480dca9jw1e9t2bslcygj20gv096my7.jpg" alt="最终效果图.png" /></p>

<hr />

<h4 id="new-project">1. New Project(新建工程)</h4>

<p>如何新建工程？</p>

<ul>
  <li>
    <p>打开LabWindows/CVI程序后，如果弹出如下页面(启动页)。则通过选择<strong>New</strong>版块的<strong>Project</strong>选项即可新建工程</p>
  </li>
  <li>
    <p><img src="http://ww1.sinaimg.cn/large/6480dca9jw1e9t2cxnz38j20l60f5acy.jpg" alt="Startup-page.png" /></p>
  </li>
  <li>
    <p>如果打开程序后直接看到的是程序主界面，则直接通过菜单栏 <strong>File</strong> » <strong>New</strong> » <strong>Project(*.prj)</strong> 即可新建工程</p>
  </li>
</ul>

<p>在之后弹出的<strong>New Project Options</strong>对话框中，保留系统默认选项，直接点击<strong>OK</strong>即可</p>

<h4 id="new-source-filec">2. New Source File(新建.c代码源文件)</h4>

<p>通过菜单栏依次选择 <strong>File</strong> » <strong>New</strong> » <strong>Source(*.c)</strong> 即可新建代码源文件</p>

<p>此时需要保存一下我们新建的工程，通过菜单栏依次选择<strong>File</strong> » <strong>Add Untitled1.c to project</strong>(添加代码源文件到工程中)，此时会弹出如下对话框(LabWindows/CVI Message)</p>

<p><img src="http://ww2.sinaimg.cn/large/6480dca9jw1e9t2e135jpj20bz04iq3d.jpg" alt="You-must-name-.c-file-name-before-using-it.png" /></p>

<p>对话框内容为：代码源文件只有在命名后才可以被添加到Project中，所以你需要首先给代码源文件命名并选择其存储位置，我们把它保存在任意位置的<strong>project3</strong>文件夹下，并将其命名为 <em>src3.c</em>。</p>

<p>此时新建工程及其系列文件(源代码文件、用户界面文件、配置文件等)都将被自动命名为 <em>src.后缀</em></p>

<h4 id="cmain">3. 在.c代码文件中添加main()函数</h4>

<table>
  <tbody>
    <tr>
      <td>我们知道LabWindows/CVI使用的c语言作为编程语言，而c语言中的 <code>main()</code> 函数则是整个程序的入口，所以我们首先为源代码文件添加 <code>main()</code> 函数<em>(下面的 <code>main()</code> 函数代码由系统根据用户界面文件(</em>**</td>
      <td>.uir<em>*)自动生成，算是LabWindows/CVI程序的 <code>main()</code> 函数的原始框架，最好把它复制到源代码文件中，不推荐手敲。下面会详细解释这个main()函数的默认运行机制)</em></td>
    </tr>
  </tbody>
</table>

<p>```c 
#include <cvirte.h>     
#include <userint.h>
#include "src.h"</userint.h></cvirte.h></p>

<p>static int panelHandle;</p>

<p>int main (int argc, char <em>argv[]){
    if (InitCVIRTE (0, argv, 0) == 0)
        return -1;  /</em> out of memory */
    if ((panelHandle = LoadPanel (0, “src.uir”, PANEL)) &lt; 0)
        return -1;
    DisplayPanel (panelHandle);
    RunUserInterface ();
    DiscardPanel (panelHandle);
    return 0;
} 
```</p>

<p>关于上面的<code>main()</code>函数：</p>

<p>```c Read with the Comment https://code.csdn.net/snippets/66860
#include <cvirte.h>     
#include <userint.h>
#include "src.h"
# 上面的include语句是引入系统所需的一些内置函数，  
# 稍懂C语言的应该不会对此陌生</userint.h></cvirte.h></p>

<h1 id="panelhandle">panelHandle是整个程序的灵魂支柱，</h1>
<p># 它持有着系统/程序主面板(如果程序有图形化界面的话)
# 在系统内存中的<strong>句柄</strong>，意即编程人员需要通过这个句柄
# 来与主面板进行交互
static int panelHandle;</p>

<h1 id="main">传说中的main()函数</h1>
<p>int main (int argc, char <em>argv[]){
    # 系统初始化
    if (InitCVIRTE (0, argv, 0) == 0)
        return -1;  /</em> out of memory */
    # LoadPanel是LabWindows/CVI的自带函数(以后简称”Lab自带函数”)
    # 它的作用是什么呢？请把光标放到LoadPanel这个函数名的任意位置，然后按F1，
    # 接着会弹出 NI LabWindows/CVI Help 面板(如下图所示)，
    # 面板左面是索引选项，面板右面便是我们的LoadPanel()函数的详细使用说明
    # 看着一大堆英文是不是觉得有些头大？但我强烈推荐你硬着头皮看下去，因为
    # 这个函数很重要，而且关于它的使用帮助包含了很多LabWindows/CVI程序的构建机理
    # 也许刚开始你会觉得看的云里雾里，但只要每次接触新函数时花功夫看上一会，
    # 一星期后你就会感觉编写程序似有”游刃有余”之感了，而到此时，你已经几乎可以
    # 不借助外界帮助(用搜索引擎、官方BBS论坛查找信息)独立完成大部分的编程工作了
    if ((panelHandle = LoadPanel (0, “src.uir”, PANEL)) &lt; 0)
        return -1;
    DisplayPanel (panelHandle);
    RunUserInterface ();
    DiscardPanel (panelHandle);
    return 0;
}
```</p>

<p>话虽如此，还是简单介绍一下main()函数的运行流程吧：</p>

<ol>
  <li>首先使用<code>InitCVIRTE (0, argv, 0)</code>函数进行系统初始化；</li>
  <li>接着开始<strong>选择</strong>并<strong>载入</strong>图形界面(主面板)文件，准备显示图形。这一步的一种通用做法是：<code>panelHandle = LoadPanel (0, "src.uir", PANEL))</code> ，即用 <code>LoadPanel()</code> Lab自带函数载入你之前已经创建好的图形界面描述文件(<strong>.uir</strong>文件或<strong>.tui</strong>文件，看看本系列教程中上两章所创建的工程，其中都带有<strong>.uir</strong>图形界面描述文件)，并在载入后将该面板资源在系统内存中的<strong>句柄</strong>(handle)交给(赋值给)我们之前创建的全局变量 <code>panelHandle</code> 。但是本章教程中并没创建图形界面描述文件，因为我们是要用纯代码实现创建图形控件并使其发挥一定功用。</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code>DisplayPanel (panelHandle)</code></td>
          <td>上一步，我们载入图形界面描述文件，并获得了其在系统内存中的句柄(即 <code>panelHandle</code> )，这一步便是将这个图形界面显示出来。使用 <code>DisplayPanel()</code> 函数可以完成此项工作</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><code>RunUserInterface()</code> 将开始运行图形界面，并将捕获到的用户事件(events)分发给回调函数。我们来看看 <code>RunUserInterface</code> 的使用说明。在 <code>RunUserInterface</code> 上按F1(或在打开的<strong>NI LabWindows/CVI Help</strong>面板的左侧，点击<strong>索引(N)</strong>标签，然后在搜索框中输入 <code>RunUserInterface</code> 后回车。在<strong>用途</strong>(Purpose)部分，我们看到这样一段话：<em>RunUserInterface does not return until you call QuitUserInterface from within a callback function. RunUserInterface returns the value that you pass to QuitUserInterface.</em> 也就是说 <code>RunUserInterface()</code> 一旦执行，它不会立即返回(return)，所以跟在它后面的代码也就不会立即执行。那么这个函数何时才会返回呢？<strong>直到你主动在某个<code>回调函数</code>中调用 <code>QuitUserInterface()</code> 函数</strong>， <code>RunUserInterface()</code> 才会返回，而且它的返回值是你传入 <code>QuitUserInterface()</code> 的参数。PS：<code>QuitUserInterface()</code> 一般出现在<strong>系统退出按钮</strong>或<strong>主面板右上角的”x”关闭按钮</strong>的回调函数中。</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td><code>DiscardPanel (panelHandle)</code></td>
          <td>载入到系统内存中的图形界面资源，必须在系统退出前被清理掉，以防止程序给PC内存留下太多垃圾。<code>DiscardPanel (panelHandle)</code> 便是做此项工作的，按F1查看它的使用说明，它的用途(Purpose)部分写到：<em>Removes a panel and any of its child panels from memory and clears them from the screen if visible.You must call DiscardPanel from the thread in which you create the panel.</em> 即：<em>将一个面板(panel)及其所有的子面板(child panel,面板可以有父子关系)从内存中移除；如果它们正显示在屏幕上，则清除这些图像。而且你必须在创建面板的线程中(多线程范畴)调用<code>DiscardPanel()</code></em></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><code>return 0</code> 退出 <code>main()</code> 函数，程序运行结束。 </li>
</ol>

<p>LabWindows/CVI程序的main()函数的运行机制基本如此。当然只要不颠倒上述几个部分的顺序的话，你可以在 <code>main()</code> 函数的任意位置添加任意有逻辑的代码。下一节我们将从修改上述 <code>main()</code> 函数着手，编写本章内容需要的 <code>main()</code> 函数。</p>

<h4 id="main-1">4. 开始编写main()函数</h4>

<p>上一节我们只是从其他地方复制了一份LabWindows/CVI程序的 <code>main()</code> 函数框架，但它并不能满足我们的需求，我们需要在此基础上修改它。</p>

<p>4.1 第一步不改动原框架，使用 <code>InitCVIRTE()</code> 函数进行系统初始化</p>

<pre><code>if ( InitCVIRTE(0, argv, 0) == 0 ) 
    return -1;  /* out of memory */
</code></pre>

<p>4.2 原框架的第二步是：</p>

<pre><code>panelHandle = LoadPanel (0, "src.uir", PANEL))
</code></pre>

<p>即<em>使用Lab自带函数 <code>LoadPanel()</code> 载入用户之前创建的图形界面描述文件(<strong>.uir</strong>/<strong>.tui</strong>)</em>，但我们要自己用代码创建图形界面的，<strong>所以这一步的内容改为</strong>：</p>

<pre><code>panelHandle = createGUI_Mine() # GUI = Graphic User Interface
</code></pre>

<p><code>createGUI_Mine()</code> 是我们自己编写的函数，它的作用是创建一个面板，并将创建好的面板资源的句柄(handle)返回(return)。为了与Lab系统自带函数区别开来，我们在函数名之后添加了 <code>_Mine</code> 标记（<em>其实这个标记可有可无</em>）。</p>

<p>4.3 剩余部分跟源框架保持一致：</p>

<pre><code>DisplayPanel (panelHandle);
RunUserInterface ();
DiscardPanel (panelHandle);
return 0;
</code></pre>

<h4 id="createguimine-">5. 编写 <code>createGUI_Mine()</code> 函数的具体实现</h4>
<p>第5部分内容将在<a href="http://lanfengming.com/Labwindows-tutorial-chapter3-part2.html/">下一篇中继续</a></p>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://localhost:4000/tags/index.html#Tech" title="Pages tagged Tech" rel="tag" class="tag">Tech</a><a href="http://localhost:4000/tags/index.html#C" title="Pages tagged C" rel="tag" class="tag">C</a><a href="http://localhost:4000/tags/index.html#Labwindows Tutorial" title="Pages tagged Labwindows Tutorial" rel="tag" class="tag">Labwindows Tutorial</a></span>
        <span><a href="http://localhost:4000/Labwindows-tutorial-chapter3-part1" rel="bookmark" title="Labwindows.Tutorial.Chapter 3.Part1" itemprop="url">Labwindows.Tutorial.Chapter 3.Part1</a> was published on <span class="entry-date date published updated"><time datetime="2013-10-10T00:00:00+08:00" itemprop="datePublished">October 10, 2013</time></span></span>
        
        <span class="author vcard" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name" class="fn"><a href="http://localhost:4000/about" title="About Lyfing.Loo" itemprop="url">Lyfing.Loo</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://localhost:4000/make-your-own-phone-ringstones" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://localhost:4000/Labwindows-tutorial-chapter3-part2" title="Labwindows.Tutorial.Chapter 3.Part2">Labwindows.Tutorial.Chapter 3.Part2</a></h3>
          <p>#####上接[第一节][the-1st-part]的内容，我们继续本章内容的下半部分。  ### 5. 编写 `createGUI_Mine()` 函数的具体实现`createGUI_Mine()`要完成的工作有： - 创建一个主面板(即主窗口) - 在主面...&hellip; <a href="http://localhost:4000/Labwindows-tutorial-chapter3-part2">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://localhost:4000/make-your-own-phone-ringstones" title="在线切割剪辑MP3手机铃声利器！">在线切割剪辑MP3手机铃声利器！</a></h4>
            <span>Published on July 18, 2013</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://localhost:4000/Labwindows-tutorial-chapter2" title="Labwindows.Tutorial.Chapter 2">Labwindows.Tutorial.Chapter 2</a></h4>
            <span>Published on July 10, 2013</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Lyfing.Loo. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lyfing521'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
